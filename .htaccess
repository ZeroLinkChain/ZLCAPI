# ZeroLinkChain Production .htaccess
RewriteEngine On

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options SAMEORIGIN
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# CORS for API endpoints
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, X-API-Key, Authorization"

# Cache control for static assets
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
    Header always set Cache-Control "public, max-age=31536000"
</FilesMatch>

# API endpoint caching
<FilesMatch "api\.php">
    Header always set Cache-Control "public, max-age=30"
</FilesMatch>

# Compress responses
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# Route mining-specific endpoints to PHP implementation
RewriteCond %{REQUEST_URI} ^/api/(miner|rewards|integrity)
RewriteRule ^(.*)$ /api_mining.php [L,QSA]

# Route wallet endpoints to secure session-based API
RewriteCond %{REQUEST_URI} ^/api/wallet/
RewriteRule ^(.*)$ /api_wallet.php [L,QSA]

# Route other C API endpoints to proxy
RewriteCond %{REQUEST_URI} ^/api/(health|stats|chainchat|chainstore|host|vpn)
RewriteRule ^(.*)$ /api_proxy.php [L,QSA]

# Redirect legacy API calls to proper endpoints
RewriteCond %{REQUEST_URI} ^/api/(.*)$
RewriteRule ^api/(.*)$ /api.php?e=%1 [QSA,L]

# Error pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Prevent access to sensitive files
<FilesMatch "(\.htaccess|\.env|admin.*|.*\.sql|.*\.bak|.*\.backup|.*\.txt|.*\.json)$">
    Require all denied
</FilesMatch>
